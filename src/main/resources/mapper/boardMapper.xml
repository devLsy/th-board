<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://www.mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="study.example.thboard.mapper.BoardMapper">

<!-- 검색 parameter값 -->
<sql id="searchParam">
    <!-- 제목 -->
    <if test="type == 'T'.toString()">
        AND TITLE LIKE '%' || #{keyword} || '%'
    </if>
    <!-- 내용 -->
    <if test="type == 'C'.toString()">
        AND CONTENT LIKE '%' || #{keyword} || '%'
    </if>
    <!-- 작성자 -->
    <if test="type == 'W'.toString()">
        AND WRITER LIKE '%' || #{keyword} || '%'
    </if>
</sql>

    <!--게시글 목록 조회-->
    <select id="selectBoards" parameterType="BoardVo" resultType="BoardVo">
        /* 게시글 목록 조회 */
        SELECT ROWNUM AS no
	         , T1.boardNo
	         , T1.title
	         , T1.content
	         , T1.writer
	         , T1.createDate
	         , T1.updateDate
	      FROM
              (SELECT BOARD_NO AS boardNo
                    , TITLE AS title
                    , CONTENT AS content
                    , WRITER AS writer
                    , TO_CHAR(CREATE_DATE, 'YYYY-MM-DD') AS createDate
                    , TO_CHAR(UPDATE_DATE, 'YYYY-MM-DD') AS updateDate
                 FROM BOARD
                WHERE 1=1
                  AND USE_YN = 'Y'
                  <include refid="searchParam"/>
                ORDER BY CREATE_DATE DESC
              )T1
         WHERE 1=1
    </select>

    <!--게시글 작성-->
    <insert id="insertBoard" parameterType="BoardVo">
        /* 게시글 작성 */
        INSERT INTO BOARD
            (
                BOARD_NO
              , TITLE
              , CONTENT
              , WRITER
              , CREATE_DATE
            )
        VALUES
            (
                BOARD_NO_SEQ.NEXTVAL
              , #{title}
              , #{content}
              , #{writer}
              , SYSDATE
            )
    </insert>

    <!--게시글 상세-->
    <select id="selectBoardDetail" parameterType="map" resultType="BoardVo">
        /* 게시글 상세 조회 */
        SELECT BOARD_NO AS boardNo
             , TITLE AS title
             , CONTENT AS content
             , WRITER AS writer
             , CREATE_DATE AS createDate
             , UPDATE_DATE AS updateDate
          FROM BOARD
         WHERE 1=1
           AND BOARD_NO = #{boardNo}
         ORDER BY CREATE_DATE DESC
    </select>

    <!--게시글 수정-->
    <update id="updateBoard" parameterType="BoardVo">
        /* 게시글 수정 */
        UPDATE BOARD
           SET TITLE = #{title}
             , CONTENT = #{content}
             , UPDATE_DATE = SYSDATE
         WHERE BOARD_NO = #{boardNo}
    </update>

    <!--게시글 삭제-->
    <update id="deleteBoard" parameterType="map">
        /* 게시글 삭제 */
        UPDATE BOARD
           SET USE_YN = 'Y'
             , UPDATE_DATE = SYSDATE
         WHERE BOARD_NO = #{boardNo}
    </update>

</mapper>